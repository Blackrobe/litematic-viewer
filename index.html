<!DOCTYPE html>
<html>
   <head>
      <script src="https://unpkg.com/deepslate@0.10.0"></script>
      <script src="https://unpkg.com/gl-matrix@3.3.0/gl-matrix-min.js"></script>

      <script src="resource/assets.js"></script>
      <script src="resource/opaque.js"></script>

      <script src="src/litematic-utils.js"></script>
      <script src="src/script.js"></script>
   </head>

   <body>
      <h1>JANKY AF litematic viewer by Ending_Credits</h1>
      <h2>Powered by <a href="https://github.com/misode/deepslate">DeepSlate</a></h2>
      <h3>Complain about it <a href="https://discord.gg/GJckUsHsVB">here (discord invite)</a> (expect improvements soon)</h3>

      <input type="file" onchange="readFile(this)">
      <br />

      <script>
         function readFile(input) {
            let file = input.files[0];
         
            let reader = new FileReader();
            reader.readAsArrayBuffer(file);

            reader.onload = function(evt) {
               const nbtdata = deepslate.readNbt(new Uint8Array(reader.result));//.result; // Don't care about .compressed
               console.log(nbtdata.value);
               var litematic = readLitematicFromNBTData(nbtdata);

               renderStructure(litematic);
            };

            reader.onerror = function() {
               console.log(reader.error);
            };
            
            // Remove input form to stop people submitting twice
            input.parentNode.appendChild(document.createElement("br"));
            input.parentNode.appendChild(document.createTextNode(file.name));
            input.parentNode.removeChild(input);
         }
      </script>

      <canvas id="canvas" width="600" height="480"></canvas>
      <img id="atlas" src="https://raw.githubusercontent.com/misode/deepslate-demo/main/atlas.png" alt="Texture atlas" crossorigin="anonymous" hidden>

   </body>
</html>
